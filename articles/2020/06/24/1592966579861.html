<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>CentOS7 下 Docker 相关操作 | 一人行者</title><script src="https://cdn.bootcss.com/valine/1.4.4/Valine.min.js"></script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="一人行者" type="application/atom+xml">
</head><body><header><nav><a href="/">Home</a><a href="/archives/">Archives</a></nav></header><main><article><div id="post-bg"><div id="post-title"><h1>CentOS7 下 Docker 相关操作</h1><hr></div><div id="post-content"><p><img src="https://img.hacpai.com/bing/20191104.jpg?imageView2/1/w/960/h/540/interlace/1/q/100"></p>
<h1 id="CentOS7下Docker相关操作"><a href="#CentOS7下Docker相关操作" class="headerlink" title="CentOS7下Docker相关操作"></a>CentOS7下Docker相关操作</h1><h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><ul>
<li>Docker目前使用越来越多，并且渐渐熟悉后也体会到了一些方便快捷之处，此处记录一下目前接触到的相关操作。<h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2></li>
</ul>
<ol>
<li>查看内核，版本必须高于3.10<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">uname -r<br></code></pre></td></tr></table></figure></li>
<li>移除旧的版本<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">sudo yum remove docker*<br></code></pre></td></tr></table></figure></li>
<li>安装一些必要的系统工具<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">sudo yum install -y yum-utils device-mapper-persistent-data lvm2<br></code></pre></td></tr></table></figure></li>
<li>添加软件源信息（这里拉取阿里云的镜像）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">$ sudo yum-config-manager --add-repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo<br></code></pre></td></tr></table></figure></li>
<li>更新 yum 缓存<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">sudo yum makecache fast<br></code></pre></td></tr></table></figure></li>
<li>安装 Docker-ce（社区版）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">sudo yum -y install docker-ce<br></code></pre></td></tr></table></figure></li>
<li>启动 Docker 后台服务<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">sudo systemctl start docker<br></code></pre></td></tr></table></figure></li>
<li>测试运行 hello-world<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">docker run hello-world<br></code></pre></td></tr></table></figure></li>
<li>添加开机启动<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">sudo systemctl enable docker<br></code></pre></td></tr></table></figure>
<h2 id="简易安装mysql5-7"><a href="#简易安装mysql5-7" class="headerlink" title="简易安装mysql5.7"></a>简易安装mysql5.7</h2></li>
<li>拉取官方镜像<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">docker pull mysql:5.7<br></code></pre></td></tr></table></figure></li>
<li>创建映射目录<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs linux"># 创建映射目录<br>mkdir -p &#x2F;root&#x2F;mysql&#x2F;data &#x2F;root&#x2F;mysql&#x2F;logs &#x2F;root&#x2F;mysql&#x2F;conf<br># 创建配置文件<br>cd &#x2F;root&#x2F;mysql&#x2F;conf<br>touch my.cnf<br></code></pre></td></tr></table></figure></li>
<li>创建并运行容器（注意设置密码）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">docker run -p 3306:3306 --name mysql -v &#x2F;root&#x2F;mysql&#x2F;conf:&#x2F;etc&#x2F;mysql&#x2F;conf.d -v &#x2F;root&#x2F;mysql&#x2F;logs:&#x2F;logs -v &#x2F;root&#x2F;mysql&#x2F;data:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;root -d mysql:5.7<br></code></pre></td></tr></table></figure></li>
<li>远程连接</li>
</ol>
<h2 id="SpringBoot项目打包Docker镜像"><a href="#SpringBoot项目打包Docker镜像" class="headerlink" title="SpringBoot项目打包Docker镜像"></a>SpringBoot项目打包Docker镜像</h2><p>此处参考<a target="_blank" rel="noopener" href="https://github.com/xkcoding/spring-boot-demo">该开源项目</a></p>
<h3 id="手动打包"><a href="#手动打包" class="headerlink" title="手动打包"></a>手动打包</h3><blockquote>
<p>手动打包需要确保打包环境下有安装Docker</p>
</blockquote>
<ol>
<li>制作Dockerfile，例子如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs plain"># 基础镜像<br>FROM openjdk:8-jdk-alpine<br><br># 作者信息<br>MAINTAINER &quot;Yangkai.Shen 237497819@qq.com&quot;<br><br># 添加一个存储空间<br>VOLUME &#x2F;tmp<br><br># 暴露8080端口<br>EXPOSE 8080<br><br># 添加变量，如果使用dockerfile-maven-plugin，则会自动替换这里的变量内容<br>ARG JAR_FILE&#x3D;target&#x2F;spring-boot-demo-docker.jar<br><br># 往容器中添加jar包<br>ADD $&#123;JAR_FILE&#125; app.jar<br><br># 启动镜像自动运行程序<br>ENTRYPOINT [&quot;java&quot;,&quot;-Djava.security.egd&#x3D;file:&#x2F;dev&#x2F;urandom&quot;,&quot;-jar&quot;,&quot;&#x2F;app.jar&quot;]<br></code></pre></td></tr></table></figure></li>
<li>打包<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">docker build -t spring-boot-demo-docker .<br></code></pre></td></tr></table></figure></li>
<li>运行<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">docker run -d -p 9090:8080 spring-boot-demo-docker<br></code></pre></td></tr></table></figure>
<h3 id="使用maven插件打包"><a href="#使用maven插件打包" class="headerlink" title="使用maven插件打包"></a>使用maven插件打包</h3></li>
</ol>
<blockquote>
<p>使用maven插件打包须确保打包环境下有安装docker和maven</p>
</blockquote>
<ol>
<li>pom.xml中添加插件<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dockerfile-version</span>&gt;</span>1.4.9<span class="hljs-tag">&lt;/<span class="hljs-name">dockerfile-version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>      <br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.spotify<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dockerfile-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;dockerfile-version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span>$&#123;project.build.finalName&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tag</span>&gt;</span>$&#123;project.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">tag</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">buildArgs</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">JAR_FILE</span>&gt;</span>target/$&#123;project.build.finalName&#125;.jar<span class="hljs-tag">&lt;/<span class="hljs-name">JAR_FILE</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">buildArgs</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>default<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>build<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><br></code></pre></td></tr></table></figure></li>
<li>执行mvn打包命令，因为插件中 execution 节点配置了 package，所以会在打包的时候自动执行 build 命令<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">mvn clean package -Dmaven.test.skip&#x3D;true<br></code></pre></td></tr></table></figure></li>
<li>查看镜像<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">docker images<br></code></pre></td></tr></table></figure></li>
<li>运行<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">docker run -d -p 9090:8080 spring-boot-demo-docker:1.0.0-SNAPSHOT<br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="本地单机搭建Portainer"><a href="#本地单机搭建Portainer" class="headerlink" title="本地单机搭建Portainer"></a>本地单机搭建Portainer</h2><h3 id="Portainer介绍"><a href="#Portainer介绍" class="headerlink" title="Portainer介绍"></a>Portainer介绍</h3><p>Portainer是Docker的图形化管理工具，提供状态显示面板、应用模板快速部署、容器镜像网络数据卷的基本操作（包括上传下载镜像，创建容器等操作）、事件日志显示、容器控制台操作、Swarm集群和服务等集中管理和操作、登录用户管理和控制等功能。功能十分全面，基本能满足中小型单位对容器管理的全部需求。</p>
<h3 id="单机版运行"><a href="#单机版运行" class="headerlink" title="单机版运行"></a>单机版运行</h3><ol>
<li>pull镜像<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">docker pull docker.io&#x2F;portainer&#x2F;portainer<br></code></pre></td></tr></table></figure></li>
<li>运行容器<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs linux">docker run -d -p 9000:9000 \<br>--restart&#x3D;always \<br>-v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock \<br>--name prtainer-test \<br>docker.io&#x2F;portainer&#x2F;portainer<br></code></pre></td></tr></table></figure></li>
<li>登录查看本地镜像与容器</li>
</ol>
<ul>
<li>访问<a target="_blank" rel="noopener" href="http://ip:9000/">http://IP:9000</a></li>
<li>首次进入需要给管理员admin初始化密码</li>
<li>单机版选择local即可</li>
</ul>
<div id="paginator"></div></div><div id="post-footer"><hr><a href="/articles/2020/07/30/1596097184978.html">← Prev Vue标签拖拽实现与部分踩坑记录</a><span style="color: #fe2"> | </span><a href="/articles/2020/06/16/1592303153618.html">ElementUI表格表头高度设置问题 Next →</a><hr></div><div id="bottom-btn"><a id="to-index" href="#post-index" title="index">≡</a><a id="to-top" href="#post-title" title="to top">∧</a></div><div id="Valine"></div><script>new Valine({
 el: '#Valine'
 , appId: ''
 , appKey: ''
 , placeholder: '此条评论委托企鹅物流发送'
})</script></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/"> Dr.CrissMagic</a></h1><section id="total"><a id="total-archives" href="/archives"><span class="total-title">Archives Total:</span><span class="total-number">25</span></a><div id="total-tags"><span class="total-title">Tags:</span><span class="total-number">28</span></div><div id="total-categories"><span class="total-title">Categories:</span><span class="total-number">0</span></div></section></div><div id="aside-block"></div><footer><nobr><span class="text-title">©</span><span class="text-content">1970 to 2020</span></nobr><wbr><nobr><span class="text-title">ICP</span><span class="text-content">——备案号——</span></nobr><wbr><wbr><nobr>published with&nbsp;<a target="_blank" rel="noopener" href="http://hexo.io">Hexo&nbsp;</a></nobr><wbr><nobr>Theme&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight&nbsp;</a></nobr><wbr><nobr>by&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/arknights.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script></body></html>