<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Centos7部署Sonarqube6.7.4 | 一人行者</title><script src="https://cdn.bootcss.com/valine/1.4.4/Valine.min.js"></script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="一人行者" type="application/atom+xml">
</head><body><header><nav><a href="/">Home</a><a href="/archives/">Archives</a></nav></header><main><article><div id="post-bg"><div id="post-title"><h1>Centos7部署Sonarqube6.7.4</h1><hr></div><div id="post-content"><p><img src="https://img.hacpai.com/bing/20200512.jpg?imageView2/1/w/960/h/540/interlace/1/q/100"></p>
<h1 id="CentOS7-部署-Sonarqube6-7-4"><a href="#CentOS7-部署-Sonarqube6-7-4" class="headerlink" title="CentOS7 部署 Sonarqube6.7.4"></a>CentOS7 部署 Sonarqube6.7.4</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在学习 Jenkins 自动化集成的过程中学习了 Sonarqube 这个代码审查工具的用法，觉得十分不错，此处记录一下单独部署使用的过程，安装版本为 6.7.4，流程参考<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/349b4a0ac5b8">此博客</a>，下载链接如下：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/19XnSM_i7cgjQCjIwj5WdAw">s8nx</a></p>
<h2 id="具体安装步骤"><a href="#具体安装步骤" class="headerlink" title="具体安装步骤"></a>具体安装步骤</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs plain"># 1 准备工作<br># 1.1 服务器上传zip包<br><br># 1.2 安装unzip解压工具<br>yum install -y unzip<br><br># 1.3 解压<br>unzip sonarqube-6.7.4.zip<br><br># 1.4 新建文件夹并转移文件<br>mkdir &#x2F;opt&#x2F;sonar<br>mv sonarqube-6.7.4&#x2F;* &#x2F;opt&#x2F;sonar<br><br># 1.5 创建新用户。由于ES不能使用系统自带的root账户登录，所以需要建立新的用户<br>useradd sonar<br><br># 1.6 赋予权限<br>chown -R sonar. &#x2F;opt&#x2F;sonar<br><br># 2 Sonarqube配置修改<br># 2.1 sonar.properties修改<br>vim &#x2F;opt&#x2F;sonarqube-6.7.4&#x2F;conf&#x2F;sonar.properties<br><br># 具体配置如下：<br>sonar.host.url&#x3D;http:&#x2F;&#x2F;localhost:9090<br>sonar.jdbc.username&#x3D;数据库用户名<br>sonar.jdbc.password&#x3D;数据库密码<br>sonar.jdbc.url&#x3D;jdbc:mysql:&#x2F;&#x2F;数据库IP:3306&#x2F;sonar?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf8&amp;rewriteBatchedStatements&#x3D;true&amp;useConfigs&#x3D;maxPerformance<br>sonar.web.host&#x3D;0.0.0.0<br>## 配置web访问的路径 这里必须要有 &#x2F; 前缀<br>sonar.web.context&#x3D;&#x2F;sonar<br>## web容器的端口号<br>sonar.web.port&#x3D;9090<br><br># 2.2 需要注意的是Sonarqube默认9000端口，ES默认9001端口，这两个端口在服务器上均不能被占用，所以可根据实际情况进行修改，ES端口在下方配置中：<br><br># Elasticsearch port. Default is 9001. Use 0 to get a free port.<br># As a security precaution, should be blocked by a firewall and not exposed to the Internet.<br># sonar.search.port&#x3D;9001<br><br># 此处需要放开配置进行修改<br><br># 3 运行启动<br><br># 3.1 切换目录<br>cd &#x2F;opt&#x2F;sonarqube-6.7.4<br><br># 3.2 相关操作<br><br># 启动<br>su sonar .&#x2F;bin&#x2F;linux-x86-64&#x2F;sonar.sh start <br># 查看状态<br>su sonar .&#x2F;bin&#x2F;linux-x86-64&#x2F;sonar.sh status<br># 停止 <br>su sonar .&#x2F;bin&#x2F;linux-x86-64&#x2F;sonar.sh stop <br># 重新启动<br>su sonar .&#x2F;bin&#x2F;linux-x86-64&#x2F;sonar.sh start<br># 查看日志<br>tail -f logs&#x2F;sonar.logs <br><br># 3.3 若启动报错可查看logs目录下的文件信息进行排查<br><br># 4 访问Sonarqube，默认账户：admin&#x2F;admin<br>http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:9090<br></code></pre></td></tr></table></figure>

<h2 id="中文汉化"><a href="#中文汉化" class="headerlink" title="中文汉化"></a>中文汉化</h2><ul>
<li>汉化版本参考如下 <a target="_blank" rel="noopener" href="https://github.com/SonarQubeCommunity/sonar-l10n-zh/tree/sonar-l10n-zh-plugin-8.3">github</a></li>
<li>需要选择下载对应版本的汉化 jar 包，例如此处安装 6.7.4 对应 <a target="_blank" rel="noopener" href="https://github.com/SonarQubeCommunity/sonar-l10n-zh/releases/tag/sonar-l10n-zh-plugin-1.19">1.19 版本</a><br><img src="https://b3logfile.com/file/2020/05/image-b47aa498.png" alt="image.png"></li>
<li>下载后放入 <code>/opt/sonar/extensions/plugins</code> 目录下再重新启动即可</li>
</ul>
<h2 id="使用后补充"><a href="#使用后补充" class="headerlink" title="使用后补充"></a>使用后补充</h2><p>最近在进行分析的时候总会出现错误，IDEA终端报错：<br><img src="https://b3logfile.com/file/2020/06/image-8312347a.png" alt="image.png"></p>
<p>查看日志文件发现如下信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plain">Caused by: com.mysql.jdbc.PacketTooBigException: Packet for query is too large (6146004 &gt; 4194304). You can change this value on the server by setting the max_allowed_packet&#39; variable.<br>	at com.mysql.jdbc.MysqlIO.send(MysqlIO.java:3678)<br>	at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:2509)<br>	at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:2680)<br>	at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2490)<br>	at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:1858)<br>	at com.mysql.jdbc.PreparedStatement.executeUpdateInternal(PreparedStatement.java:2079)<br>	at com.mysql.jdbc.PreparedStatement.executeUpdateInternal(PreparedStatement.java:2013)<br>	at com.mysql.jdbc.PreparedStatement.executeLargeUpdate(PreparedStatement.java:5104)<br>	at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1998)<br>	at org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:105)<br>	at org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:105)<br>	at org.sonar.db.ce.CeTaskInputDao.insert(CeTaskInputDao.java:53)<br>	... 45 common frames omitted<br></code></pre></td></tr></table></figure>
<p>经过搜索后发现这个是mysql的设置max_allowed_packet太小的原因，可以通过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">show VARIABLES like &#39;%max_allowed_packet%&#39;;<br></code></pre></td></tr></table></figure>
<p>查看具体值，此处需要将这个值修改大。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain"># 修改mysql配置文件<br>vim &#x2F;etc&#x2F;my.cnf<br><br># 添加max_allowed_packet配置，1073741824为1024*1024*1024，即1G，此处可以修改为其他合适的值<br>max_allowed_packet&#x3D;1073741824<br><br># wq保存后，重启mysql<br></code></pre></td></tr></table></figure>
<p>之后可以再次通过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">show VARIABLES like &#39;%max_allowed_packet%&#39;;<br></code></pre></td></tr></table></figure>
<p>查看是否修改成功</p>
<div id="paginator"></div></div><div id="post-footer"><hr><a href="/articles/2020/06/04/1591237014985.html">← Prev 程序员专用知识类网站推荐（持续更新）</a><span style="color: #fe2"> | </span><a href="/articles/2020/05/12/1589258874768.html">使用阿里云服务器跳转访问公司内网 Next →</a><hr></div><div id="bottom-btn"><a id="to-index" href="#post-index" title="index">≡</a><a id="to-top" href="#post-title" title="to top">∧</a></div><div id="Valine"></div><script>new Valine({
 el: '#Valine'
 , appId: ''
 , appKey: ''
 , placeholder: '此条评论委托企鹅物流发送'
})</script></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/"> Dr.CrissMagic</a></h1><section id="total"><a id="total-archives" href="/archives"><span class="total-title">Archives Total:</span><span class="total-number">25</span></a><div id="total-tags"><span class="total-title">Tags:</span><span class="total-number">28</span></div><div id="total-categories"><span class="total-title">Categories:</span><span class="total-number">0</span></div></section></div><div id="aside-block"></div><footer><nobr><span class="text-title">©</span><span class="text-content">1970 to 2020</span></nobr><wbr><nobr><span class="text-title">ICP</span><span class="text-content">——备案号——</span></nobr><wbr><wbr><nobr>published with&nbsp;<a target="_blank" rel="noopener" href="http://hexo.io">Hexo&nbsp;</a></nobr><wbr><nobr>Theme&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight&nbsp;</a></nobr><wbr><nobr>by&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/arknights.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script></body></html>